<div class="page-header" id="banner">
  <div class="row">
    <div class="col-lg-12 col-md-12">
      <h2>商品情報を取得</h2>
      <%= form_tag('/products/search', method:'post', multipart: true) do %>
        <div class="form-group">
          <div class="form-check" onclick="entryChange1();">
            ASINの入力方法を選択
            <label class="form-check-label">
              <%= radio_button_tag 'search[condition]', 'from_url', checked:"checked" %>
              検索URL
            </label>
            <label class="form-check-label">
              <%= radio_button_tag 'search[condition]', 'from_file' %>
              ファイル
            </label>
          </div>
          <div class="form-inline" id="url_form">
            <%= submit_tag '開始', class:'btn btn-primary' %>&nbsp;&nbsp;&nbsp;
            <%= label_tag 'search[url]', 'URL:', class:'form-label' %>
            <%= text_field_tag 'search[url]','', class:'form-control' %>
          </div>
          <div class="form-inline" id="asin_form" style="display: none;">
            <%= submit_tag '開始', class:'btn btn-primary' %>&nbsp;&nbsp;&nbsp;
            <div class="form-group" style="width: 350px">
              <%= file_field_tag :file %>
            </div>
          </div>
        </div>
      <% end %>
      <table class="table table-striped table-hover table-bordered table-headerfixed ellipsis tablesorter" id="result_table">
        <thead class="thead-inverse" style="font-size: 9pt;">
          <tr>
            <th width="4%">出品</th>
            <th width="9%">ASIN</th>
            <th width="16%">アマゾン</th>
            <th width="16%">ヤフショ</th>
            <th width="8%">アマゾン<br>価格</th>
            <th width="8%">アマゾン<br>手数料</th>
            <th width="8%">ヤフショ<br>価格</th>
            <th width="7%">ヤフショ<br>送料</th>
            <th width="8%" class="info text-danger">利益額</th>
            <th width="6%">利益率</th>
            <th width="5%">モノ<br>レート</th>
            <th width="5%">出品<br>制限</th>
          </tr>
        </thead>
        <% if @products != nil then %>
        <tbody style="font-size: 9pt;">
          <% for temp in @products %>
          <% points = (temp.normal_point.to_f + temp.premium_point.to_f + temp.softbank_point.to_f) %>
          <% if temp.cart_price != 0 then aprice = temp.cart_price else aprice = temp.lowest_price end %>
          <% profit = (aprice - (aprice * temp.amazon_fee.to_f) - (temp.yahoo_price.to_f - points + temp.yahoo_shipping.to_f)).to_i %>
          <tr>
            <td width="4%" style="text-align:center;"><input type="checkbox" name="chk_1" value="1" id="<%= temp.asin %>" style="margin-top: 30px;" /></td>
            <td width="9%"><br><br><%= temp.asin %></td>
            <td width="16%" style="white-space: normal; text-overflow: clip;"><img src="<%= temp.amazon_image %>" alt="アマゾン画像" height="60" /><br><a href="https://www.amazon.co.jp/dp/<%= temp.asin %>" target="_blank"><%= temp.title %></a></td>
            <td width="16%" style="white-space: normal; text-overflow: clip;"><% if temp.yahoo_code != nil then %><img src="<%= temp.yahoo_image %>" alt="ヤフオク画像" height="60" /><br><a href="https://store.shopping.yahoo.co.jp/<%= temp.yahoo_code.gsub("_","/") %>" target="_blank"><%= temp.yahoo_title %></a><% else %><br><br><%= temp.yahoo_title %><% end %></td>
            <td width="8%" style="text-align:center;"><br><br><%= aprice.to_i %></td>
            <td width="8%" style="text-align:center;"><br><br><%= (aprice * temp.amazon_fee.to_f).to_i %></td>
            <td width="8%" style="text-align:center;"><br><br><%= (temp.yahoo_price.to_f - points).to_i %></td>
            <td width="7%" style="text-align:center;"><br><br><%= temp.yahoo_shipping.to_i %></td>
            <% if profit > 0 then %>
              <td width="8%" style="text-align:center;" class="warning text-danger"><br><br><b><%= profit %></b></td>
            <% else %>
              <td width="8%" style="text-align:center;" class="warning"><br><br><b><%= profit %></b></td>
            <% end  %>
            <td width="6%" style="text-align:center;"><br><br><% if profit != 0 then %><%= (((aprice - (aprice * temp.amazon_fee.to_f) - (temp.yahoo_price.to_f - points + temp.yahoo_shipping.to_f)) / (temp.yahoo_price.to_f - points))*100).round(1) %><% else %>0<% end %></td>
            <td width="5%"><br><a href="https://mnrate.com/item/aid/<%= temp.asin %>" target="_blank"><%= image_tag('mnrate.png', :height => "30pt") %></a></td>
            <td width="5%"><br><a href="https://sellercentral.amazon.co.jp/productsearch?q=<%= temp.asin %>" target="_blank"><%= image_tag('amazon.png', :height => "30pt") %></a></td>
          </tr>
          <% end %>
        </tbody>
        <% end %>
      </table>
    </div>
  </div>
</div>

<script type="text/javascript">
   $(document).ready(function()
       {
           $("#result_table").tablesorter();
       }
   );
</script>
